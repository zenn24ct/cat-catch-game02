<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>çŒ«ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸ±ğŸŸ</title>
  <style>
    :root{
      --bg:#f8fafc; --card:#ffffff; --accent:#ff6b6b; --muted:#6b7280;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo, sans-serif;background:linear-gradient(180deg,#e6f7ff 0%, #f8fafc 60%);}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .panel{background:var(--card);border-radius:14px;padding:12px;box-shadow:0 6px 20px rgba(27,40,60,0.06)}

    #game-area{position:relative;overflow:hidden;border-radius:12px;height:560px;background:linear-gradient(180deg,#dff6ff 0,#ccecff 60%);display:flex;flex-direction:column}
    #sky{flex:1;position:relative}
    #ground{height:84px;background:linear-gradient(180deg,#9ee6a0,#7cd07a);display:flex;align-items:center;justify-content:center}

    /* HUD */
    .hud{display:flex;justify-content:space-between;align-items:center;padding:12px}
    .score{font-weight:700;font-size:18px}
    .lives{display:flex;gap:6px;align-items:center}
    .heart{font-size:20px;filter:drop-shadow(0 1px 0 rgba(0,0,0,0.06))}

    /* Cat */
    .cat{position:absolute;bottom:86px;left:50%;transform:translateX(-50%);font-size:44px;user-select:none;pointer-events:none}
    .cat-shadow{position:absolute;bottom:70px;left:50%;transform:translateX(-50%);width:100px;height:8px;border-radius:50%;background:rgba(0,0,0,0.08);filter:blur(6px);}

    /* Fish */
    .fish{position:absolute;font-size:34px;user-select:none}

    /* Overlay screens */
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.4));backdrop-filter:blur(4px)}
    .menu{background:var(--card);padding:20px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(20,40,80,0.08)}
    .menu h2{margin:0 0 8px 0}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--accent);color:white;font-weight:700;border:none;cursor:pointer}
    .muted{color:var(--muted);font-size:14px}

    /* responsive */
    @media (max-width:600px){
      #game-area{height:72vh}
      .cat{font-size:36px}
      .fish{font-size:28px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>çŒ«ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  â€” è½ã¡ã¦ãã‚‹é­šã‚’ã‚­ãƒ£ãƒƒãƒã—ã‚ˆã†ï¼</h1>
    </header>

    <div id="game-area" class="panel">
      <div id="sky">
        <div class="hud">
          <div class="score">Score: <span id="score">0</span></div>
          <div class="lives" aria-live="polite">Lives: <div id="hearts"></div></div>
        </div>

        <div id="playfield" style="position:relative;height:calc(100% - 110px);">
          <!-- fish spawn here -->
          <div id="cat" class="cat" aria-hidden="true">ğŸ±</div>
          <div id="cat-shadow" class="cat-shadow"></div>
        </div>

        <!-- overlays -->
        <div id="overlay-start" class="overlay">
          <div class="menu">
            <h2>æº–å‚™ã¯ã„ã„ï¼Ÿ</h2>
            <p class="muted">çŸ¢å°ã‚­ãƒ¼ / ãƒã‚¦ã‚¹ / æŒ‡ã§çŒ«ã‚’å‹•ã‹ã—ã¦é­šã‚’ã‚­ãƒ£ãƒƒãƒ</p>
            <div style="margin-top:12px"><button id="start-btn" class="btn">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button></div>
          </div>
        </div>

        <div id="overlay-gameover" class="overlay" style="display:none">
          <div class="menu">
            <h2 id="go-title">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
            <p class="muted">ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: <span id="final-score">0</span></p>
            <div style="margin-top:12px"><button id="restart-btn" class="btn">ã‚‚ã†ä¸€åº¦</button></div>
          </div>
        </div>

      </div>

      <div id="ground"> 
        <div class="muted">çŒ«ã‚’å·¦å³ã«å‹•ã‹ã—ã¦é­šã‚’ã‚­ãƒ£ãƒƒãƒã—ã€ã‚¹ã‚³ã‚¢ã§é›£æ˜“åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚ãƒ©ã‚¤ãƒ•ãŒ0ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€‚</div>
      </div>
    </div>

    <footer style="margin-top:12px; text-align:right; font-size:13px; color:var(--muted)">ä½œæˆ: ChatGPT â€” å¤‰æ›´ã‚„è¿½åŠ æ©Ÿèƒ½ã‚‚ã§ãã¾ã™ï¼</footer>
  </div>

  <script>
  // --- Game settings ---
  const STATE = {
    score:0,
    lives:3,
    running:false,
    fishList:[],
    lastSpawn:0,
    spawnInterval:1200, // ms
    baseFallSpeed: 80, // px/s
    speedMultiplier:1,
    maxLives:3
  };

  // DOM
  const playfield = document.getElementById('playfield');
  const catEl = document.getElementById('cat');
  const shadowEl = document.getElementById('cat-shadow');
  const scoreEl = document.getElementById('score');
  const heartsEl = document.getElementById('hearts');
  const overlayStart = document.getElementById('overlay-start');
  const overlayGameover = document.getElementById('overlay-gameover');
  const startBtn = document.getElementById('start-btn');
  const restartBtn = document.getElementById('restart-btn');
  const finalScoreEl = document.getElementById('final-score');

  // Player (cat) state with smoothing
  const player = {
    xCurrent: playfield.clientWidth/2, // actual drawn position
    xTarget: playfield.clientWidth/2,  // what input sets
    width: 100,
    maxSpeed: 1000 // px/s - how fast the cat can move when following target
  };

  // Utils
  function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

  // Setup hearts
  function renderHearts(){
    heartsEl.innerHTML = '';
    for(let i=0;i<STATE.maxLives;i++){
      const span = document.createElement('span');
      span.className = 'heart';
      span.textContent = i < STATE.lives ? 'â¤ï¸' : 'ğŸ¤';
      heartsEl.appendChild(span);
    }
  }

  // Resize handler to keep cat within bounds
  function onResize(){
    if(!playfield) return;
    const w = playfield.clientWidth;
    player.xCurrent = clamp(player.xCurrent, 20, w-20);
    player.xTarget = clamp(player.xTarget, 20, w-20);
    updateCatPosition();
  }
  window.addEventListener('resize', onResize);

  // Smooth position updater (called from game loop)
  function updateCatPosition(){
    // we set left based on current interpolated X
    const w = playfield.clientWidth;
    const x = clamp(player.xCurrent, 20, w-20);
    catEl.style.left = x + 'px';
    shadowEl.style.left = x + 'px';
  }

  // Input handlers now only set xTarget (no immediate teleport)
  playfield.addEventListener('mousemove', e => {
    const rect = playfield.getBoundingClientRect();
    player.xTarget = e.clientX - rect.left;
  });
  playfield.addEventListener('touchmove', e =>{
    const rect = playfield.getBoundingClientRect();
    player.xTarget = e.touches[0].clientX - rect.left;
  }, {passive:true});

  // Click still sets target (useful on mobile tap)
  playfield.addEventListener('click', e=>{
    const rect = playfield.getBoundingClientRect();
    player.xTarget = e.clientX - rect.left;
  });

  window.addEventListener('keydown', e=>{
    // keyboard nudges the target so movement remains smooth
    const step = 28;
    if(e.key === 'ArrowLeft' || e.key === 'a') { player.xTarget -= step; }
    if(e.key === 'ArrowRight' || e.key === 'd') { player.xTarget += step; }
    // allow space to start
    if(e.code === 'Space' && overlayStart.style.display !== 'none') startGame();
  });

  // Fish factory
  const fishShapes = ['ğŸŸ','ğŸ ','ğŸ¡','ğŸ¦ˆ']; // playful variation
  function spawnFish(){
    const f = document.createElement('div');
    f.className = 'fish';
    f.textContent = fishShapes[Math.floor(Math.random()* (fishShapes.length-1))];
    const playW = playfield.clientWidth;
    const x = Math.random() * (playW - 40) + 20;
    f.style.left = x + 'px';
    f.style.top = '-48px';
    const size = 28 + Math.random()*24;
    f.style.fontSize = size + 'px';
    playfield.appendChild(f);
    const obj = {
      el: f,
      x,
      y: -48,
      size,
      speed: STATE.baseFallSpeed * (0.9 + Math.random()*0.4) * STATE.speedMultiplier
    };
    STATE.fishList.push(obj);
  }

  // Update loop
  let lastTime = null;
  function gameLoop(ts){
    if(!STATE.running) { lastTime = null; return; }
    if(!lastTime) lastTime = ts;
    const dt = (ts - lastTime) / 1000; // seconds
    lastTime = ts;

    // Smoothly move cat toward target using a max speed per second
    const diff = player.xTarget - player.xCurrent;
    const maxMove = player.maxSpeed * dt;
    // move by either the full diff (if small) or limited by maxMove
    if(Math.abs(diff) <= maxMove){
      player.xCurrent = player.xTarget;
    } else {
      player.xCurrent += Math.sign(diff) * maxMove;
    }
    updateCatPosition();

    // spawn logic
    STATE.lastSpawn += dt*1000;
    if(STATE.lastSpawn > STATE.spawnInterval){
      STATE.lastSpawn = 0;
      spawnFish();
    }

    // update fish
    for(let i = STATE.fishList.length-1; i>=0; i--){
      const fish = STATE.fishList[i];
      fish.y += fish.speed * dt;
      fish.el.style.top = fish.y + 'px';

      // collision with cat (bounding box simple)
      const catRect = catEl.getBoundingClientRect();
      const fishRect = fish.el.getBoundingClientRect();
      if(rectIntersect(catRect, fishRect)){
        // caught
        playfield.removeChild(fish.el);
        STATE.fishList.splice(i,1);
        addScore(10);
        continue;
      }

      // fell past bottom
      if(fish.y > playfield.clientHeight + 60){
        playfield.removeChild(fish.el);
        STATE.fishList.splice(i,1);
        loseLife();
      }
    }

    // difficulty scaling example: every 50 points, increase speed/spawn rate
    adjustDifficulty();

    requestAnimationFrame(gameLoop);
  }

  function rectIntersect(a,b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }

  function addScore(n){
    STATE.score += n;
    scoreEl.textContent = STATE.score;
    // small visual feedback
    scoreEl.animate([{transform:'scale(1)'},{transform:'scale(1.15)'},{transform:'scale(1)'}],{duration:250});
  }

  function loseLife(){
    STATE.lives -= 1;
    renderHearts();
    // shake cat to show loss
    catEl.animate([{transform:'translateX(-50%) translateY(0)'},{transform:'translateX(-50%) translateY(-8px)'},{transform:'translateX(-50%) translateY(0)'}],{duration:300});
    if(STATE.lives <= 0){
      endGame();
    }
  }

  function adjustDifficulty(){
    const oldMultiplier = STATE.speedMultiplier;
    STATE.speedMultiplier = 1 + Math.floor(STATE.score / 50) * 0.18; // +18% per 50 points
    STATE.spawnInterval = 1200 - Math.floor(STATE.score / 30) * 80; // spawn faster
    STATE.spawnInterval = Math.max(420, STATE.spawnInterval);

    if(STATE.speedMultiplier !== oldMultiplier){
      // bump existing fish speeds
      STATE.fishList.forEach(f => { f.speed *= (STATE.speedMultiplier/oldMultiplier); });
    }
  }

  function startGame(){
    // reset
    STATE.score = 0; STATE.lives = STATE.maxLives; STATE.fishList.forEach(f => f.el.remove()); STATE.fishList = [];
    STATE.spawnInterval = 1200; STATE.baseFallSpeed = 80; STATE.speedMultiplier = 1; STATE.lastSpawn = 0;
    scoreEl.textContent = 0; renderHearts();
    overlayStart.style.display = 'none'; overlayGameover.style.display = 'none';
    STATE.running = true; lastTime = null;
    // place cat in center
    player.xCurrent = playfield.clientWidth/2; player.xTarget = player.xCurrent; updateCatPosition();
    requestAnimationFrame(gameLoop);
  }

  function endGame(){
    STATE.running = false;
    finalScoreEl.textContent = STATE.score;
    overlayGameover.style.display = 'flex';
    document.getElementById('go-title').textContent = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼';
  }

  startBtn.addEventListener('click', startGame);
  restartBtn.addEventListener('click', startGame);

  // initial setup
  function init(){
    renderHearts();
    // center cat
    player.xCurrent = playfield.clientWidth/2; player.xTarget = player.xCurrent; updateCatPosition();

    // accessibility: allow Space to start (handled in keydown)

    // small animation to make the UI feel alive
    setInterval(()=>{
      const hearts = document.querySelectorAll('.heart');
      hearts.forEach((h,i)=> h.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:1200,delay:i*120,iterations:1}));
    },3000);
  }

  init();
  </script>
</body>
</html>
