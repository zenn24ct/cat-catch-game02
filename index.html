<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>çŒ«ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  â€” ãƒ‡ãƒãƒƒã‚°æ¸ˆã¿</title>
  <style>
    :root{--bg:#f8fafc;--card:#fff;--accent:#ff6b6b;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo, sans-serif;background:linear-gradient(180deg,#e6f7ff 0,#f8fafc 60%);}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    .panel{background:var(--card);border-radius:14px;padding:12px;box-shadow:0 6px 20px rgba(27,40,60,0.06)}
    #game-area{position:relative;overflow:hidden;border-radius:12px;height:560px;background:linear-gradient(180deg,#dff6ff 0,#ccecff 60%);display:flex;flex-direction:column}
    #sky{flex:1;position:relative}
    #ground{height:84px;background:linear-gradient(180deg,#9ee6a0,#7cd07a);display:flex;align-items:center;justify-content:center}
    .hud{display:flex;justify-content:space-between;align-items:center;padding:12px}
    .score{font-weight:700;font-size:18px}
    .lives{display:flex;gap:6px;align-items:center}
    .heart{font-size:20px}
    .cat{position:absolute;bottom:86px;left:50%;transform:translateX(-50%);font-size:44px;user-select:none;pointer-events:none}
    .cat-shadow{position:absolute;bottom:70px;left:50%;transform:translateX(-50%);width:100px;height:8px;border-radius:50%;background:rgba(0,0,0,0.08);filter:blur(6px)}
    .fish{position:absolute;font-size:34px;user-select:none}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.4));backdrop-filter:blur(4px)}
    .menu{background:var(--card);padding:20px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(20,40,80,0.08)}
    .btn{display:inline-block;padding:10px 16px;border-radius:10px;background:var(--accent);color:white;font-weight:700;border:none;cursor:pointer}
    .muted{color:var(--muted);font-size:14px}
    @media (max-width:600px){#game-area{height:72vh}.cat{font-size:36px}.fish{font-size:28px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header><h1>çŒ«ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  â€” ãƒ‡ãƒãƒƒã‚°æ¸ˆã¿</h1></header>
    <div id="game-area" class="panel">
      <div id="sky">
        <div class="hud">
          <div class="score">Score: <span id="score">0</span></div>
          <div class="lives" aria-live="polite">Lives: <div id="hearts"></div></div>
        </div>
        <div id="playfield" style="position:relative;height:calc(100% - 110px);">
          <div id="cat" class="cat" aria-hidden="true">ğŸ±</div>
          <div id="cat-shadow" class="cat-shadow"></div>
        </div>
        <div id="overlay-start" class="overlay">
          <div class="menu">
            <h2>æº–å‚™ã¯ã„ã„ï¼Ÿ</h2>
            <p class="muted">A / D ã‚­ãƒ¼ã§å·¦å³ç§»å‹•ã€ã‚¹ãƒšãƒ¼ã‚¹ã§ã‚¸ãƒ£ãƒ³ãƒ—ã€‚ãƒã‚¦ã‚¹ / ã‚¿ãƒƒãƒã§ã‚‚å¯ã€‚</p>
            <div style="margin-top:12px"><button id="start-btn" class="btn">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button></div>
          </div>
        </div>
        <div id="overlay-gameover" class="overlay" style="display:none">
          <div class="menu">
            <h2 id="go-title">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
            <p class="muted">ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: <span id="final-score">0</span></p>
            <div style="margin-top:12px"><button id="restart-btn" class="btn">ã‚‚ã†ä¸€åº¦</button></div>
          </div>
        </div>
      </div>
      <div id="ground"> 
        <div class="muted">çŒ«ã‚’å·¦å³ã«å‹•ã‹ã—ã¦é­šã‚’ã‚­ãƒ£ãƒƒãƒã—ã‚ˆã†ã€‚ã‚¹ãƒšãƒ¼ã‚¹ã§ã‚¸ãƒ£ãƒ³ãƒ—ã€‚</div>
      </div>
    </div>
    <footer style="margin-top:12px; text-align:right; font-size:13px; color:var(--muted)">ä½œæˆ: ChatGPT â€” ãƒ‡ãƒãƒƒã‚°æ¸ˆã¿</footer>
  </div>

  <script>
  // Wait for DOM ready to avoid null reads
  document.addEventListener('DOMContentLoaded', ()=>{
    // --- Game settings ---
    const STATE = {
      score:0, lives:3, running:false, fishList:[], powerups:[], lastSpawn:0,
      spawnInterval:1200, baseFallSpeed:80, speedMultiplier:1, maxLives:3,
      combo:0, comboTimer:0, highScore: parseInt(localStorage.getItem('catCatchHigh') || '0', 10)
    };

    // DOM refs (guaranteed to exist now)
    const playfield = document.getElementById('playfield');
    const catEl = document.getElementById('cat');
    const shadowEl = document.getElementById('cat-shadow');
    const scoreEl = document.getElementById('score');
    const heartsEl = document.getElementById('hearts');
    const overlayStart = document.getElementById('overlay-start');
    const overlayGameover = document.getElementById('overlay-gameover');
    const startBtn = document.getElementById('start-btn');
    const restartBtn = document.getElementById('restart-btn');
    const finalScoreEl = document.getElementById('final-score');

    if(!playfield || !catEl){ console.error('å¿…è¦ãª DOM è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚HTML ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'); return; }

    // Player state (use vx for smooth continuous A/D hold)
    const player = {
      x: playfield.clientWidth / 2, vx:0, targetVx:0, maxSpeed: 700, // px/s
      y:0, vy:0, jumping:false
    };

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function renderHearts(){ heartsEl.innerHTML=''; for(let i=0;i<STATE.maxLives;i++){ const s=document.createElement('span'); s.className='heart'; s.textContent = i < STATE.lives ? 'â¤ï¸' : 'ğŸ¤'; heartsEl.appendChild(s); } }

    function updateCatDOM(){
      const w = playfield.clientWidth;
      player.x = clamp(player.x, 20, w - 20);
      catEl.style.left = player.x + 'px';
      shadowEl.style.left = player.x + 'px';
      // bottom offset for jump visual
      catEl.style.bottom = 86 + player.y + 'px';
      // shadow scales/opacity
      const shOpacity = Math.max(0.18, 1 - player.y / 220);
      shadowEl.style.opacity = shOpacity;
      const shScale = Math.max(0.5, 1 - player.y / 600);
      shadowEl.style.transform = `translateX(-50%) scaleX(${shScale})`;
    }

    // Controls: A/D as hold keys; mouse/touch set target x
    const keys = {left:false, right:false};
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'a' || e.key === 'A') keys.left = true;
      if(e.key === 'd' || e.key === 'D') keys.right = true;
      if(e.code === 'Space'){
        if(!STATE.running && overlayStart.style.display !== 'none') startGame(); else tryJump();
      }
    });
    window.addEventListener('keyup', (e)=>{
      if(e.key === 'a' || e.key === 'A') keys.left = false;
      if(e.key === 'd' || e.key === 'D') keys.right = false;
    });

    playfield.addEventListener('mousemove', (e)=>{ const r = playfield.getBoundingClientRect(); player.x = e.clientX - r.left; updateCatDOM(); });
    playfield.addEventListener('touchmove', (e)=>{ const r = playfield.getBoundingClientRect(); player.x = e.touches[0].clientX - r.left; updateCatDOM(); }, {passive:true});
    playfield.addEventListener('click', (e)=>{ const r = playfield.getBoundingClientRect(); player.x = e.clientX - r.left; updateCatDOM(); });

    function tryJump(){ if(!player.jumping){ player.jumping = true; player.vy = 620; } }

    function rectIntersect(a,b){ return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom); }

    function addScore(n){ STATE.score += n; scoreEl.textContent = STATE.score; if(STATE.score > STATE.highScore){ STATE.highScore = STATE.score; localStorage.setItem('catCatchHigh', STATE.highScore); } }

    function loseLife(){ STATE.lives -= 1; renderHearts(); catEl.animate([{transform:'translateY(0)'},{transform:'translateY(-8px)'},{transform:'translateY(0)'}],{duration:300}); if(STATE.lives <= 0) endGame(); }

    function spawnFish(){ const f=document.createElement('div'); f.className='fish'; f.textContent='ğŸŸ'; const playW = playfield.clientWidth; const x = Math.random()*(playW-40)+20; f.style.left = x + 'px'; f.style.top = '-48px'; playfield.appendChild(f); const obj = {el:f, x, y:-48, speed: STATE.baseFallSpeed * (0.9 + Math.random()*0.4) * STATE.speedMultiplier}; STATE.fishList.push(obj); }

    let lastTime = null;
    function gameLoop(ts){
      if(!STATE.running) { lastTime = null; return; }
      if(!lastTime) lastTime = ts;
      const dt = (ts - lastTime) / 1000; lastTime = ts;

      // Update horizontal velocity from keys with smoothing
      const desired = (keys.left ? -1 : 0) + (keys.right ? 1 : 0);
      const targetV = desired * player.maxSpeed;
      // simple smoothing toward target velocity
      const accel = 3000; // px/s^2
      if(player.vx < targetV) player.vx = Math.min(targetV, player.vx + accel * dt);
      else if(player.vx > targetV) player.vx = Math.max(targetV, player.vx - accel * dt);
      player.x += player.vx * dt;

      // Jump physics
      if(player.jumping){ player.y += player.vy * dt; player.vy -= 1500 * dt; if(player.y <= 0){ player.y = 0; player.jumping = false; player.vy = 0; } }

      updateCatDOM();

      // spawn logic
      STATE.lastSpawn += dt * 1000;
      if(STATE.lastSpawn > STATE.spawnInterval){ STATE.lastSpawn = 0; spawnFish(); }

      // update fish
      for(let i = STATE.fishList.length - 1; i >= 0; i--){
        const fish = STATE.fishList[i];
        fish.y += fish.speed * dt; fish.el.style.top = fish.y + 'px';
        const catRect = catEl.getBoundingClientRect(); const fishRect = fish.el.getBoundingClientRect();
        if(rectIntersect(catRect, fishRect)){
          fish.el.remove(); STATE.fishList.splice(i,1); addScore(10); continue;
        }
        if(fish.y > playfield.clientHeight + 60){ fish.el.remove(); STATE.fishList.splice(i,1); loseLife(); }
      }

      requestAnimationFrame(gameLoop);
    }

    function startGame(){
      // reset
      STATE.score = 0; STATE.lives = STATE.maxLives; STATE.fishList.forEach(f=>f.el.remove()); STATE.fishList = [];
      STATE.spawnInterval = 1200; STATE.baseFallSpeed = 80; STATE.speedMultiplier = 1; STATE.lastSpawn = 0;
      scoreEl.textContent = 0; renderHearts(); overlayStart.style.display = 'none'; overlayGameover.style.display = 'none'; STATE.running = true; lastTime = null;
      player.x = playfield.clientWidth / 2; player.vx = 0; player.y = 0; player.jumping = false; updateCatDOM(); requestAnimationFrame(gameLoop);
    }

    function endGame(){ STATE.running = false; finalScoreEl.textContent = STATE.score; overlayGameover.style.display = 'flex'; }

    // wire up buttons
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    // initial render
    renderHearts(); updateCatDOM();

    // handle resize safely
    window.addEventListener('resize', ()=>{
      player.x = clamp(player.x, 20, playfield.clientWidth - 20); updateCatDOM();
    });
  });
  </script>
</body>
</html>
